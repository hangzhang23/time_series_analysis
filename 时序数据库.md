浅谈时序数据库

## 1. 概念

时序数据库全称为时间序列数据库，其跟常规的关系数据库SQL相比，最大的区别在于，时序数据库是以时间为索引的规律性时间间隔记录的数据库。如图所示为一个时序数据库的显示形式，其索引为timestamp，后面不同的列记录了在当前时间戳下的属性值。随着时间增长，这种记录会周期性地增加。

![img](https://5b0988e595225.cdn.sohucs.com/images/20180625/be6d10919fb74081bab3d829eedc6442.png)

其中metric表示为度量，也就是关系型数据库中的table。data point是数据点，也就是关系型数据库的row，timestamp为产生数据点的时间。而field是度量下会随着时间戳变化的属性值，tag是附加信息，一般是跟时间戳关系不大的属性信息。

时序数据库和关系型数据库的区别在于：

- 因为是频繁采集的数据，所以时序数据库的数据量非常大。
- 周期采集数据会使得数据量非常平稳。
- 因为以时间为标准所以数据记录有很强的时效性，久远的数据使用率会随着时间增加而降低。
- 和关系型数据库更多的是查询任务不同，时序性数据库更多的是写入任务。所以用了LSM Tree来代替SQL中的B Tree，从而提升了写入性能。

## 2. 使用场景

我个人是从事过对象为时序数据库的项目的。在我个人看来，时序数据库随着目前大数据时代的进一步发展，使用场景是非常广泛的。以我参与过的一个项目为例，大型商场目前在室内会测量多种参数，包括室内温度，湿度，气压，用电量，光照等等，用以保证商场能够提供给顾客最好的体验，并且能够尽可能地高效利用资源。在这种情况下，各种传感器会在一小时的每十五会准时把数据传送回数据库，给后台的工程师用以分析商场内的环境变化，并对商场环境进行相应的调整。这种数据具有很强的时效性，一般一周以后的数据就会很少在用到了。同时也有很强的周期性，季节性，对时序性数据分析很容易发现其每天的规律性，每月以及每个季度的趋势变化。这样可以更好的更有效地去对商场环境进行干预。

从上面的例子扩展到其他更多的领域，比如金融分析，工业互联网，环境监控等等，只要是与时间变化有关的项目，比如分析时间变化的规律，特点等等，都会产生大量的时序性数据。而时序数据的数据量大，以写入数据为主的特点也导致关系型数据库并不能非常有效的来完成存储工作（因为其主要是以查询为主要任务，所以存储效率不高）。而以Hbase，Cassandra为代表的时序数据库可以更好地完成时序数据的任务。

## 3. 时序数据库的挑战

时序数据库最大的挑战就是如何在海量数据中完成各种任务，可以分为如下几个方面：

- 时序数据读入：因为有时数据的写入频率非常高，达到每秒都会有上万次，如何支持高强度的写入是时序数据库的挑战。
- 时序数据读取：因为时序数据的高频性质，如何支持高强度的分组聚合运算也是一大挑战。
- 存储成本问题：如何对海量数据进行低成本的存储也是一个挑战。

